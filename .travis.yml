sudo: required

language: java
jdk: openjdk11

services: docker

before_script:
  - docker run --name postgres -p 6543:5432 -e POSTGRES_USER=test_user -e POSTGRES_PASSWORD=test_password -e POSTGRES_DB=testdb -d postgres

jobs:
  include:
    - stage: test
      script: mvn test -B
    - stage: package
      script: mvn package -B

deploy:
  if: branch = feature/ci
  provider: releases
  api_key: "158ce801d6475539f3a98d22066719c83eedc730"
  file_glob: true
  file: target/Bookshell-1.0-SNAPSHOT.jar
  skip_cleanup: true
  on:
    tags: true
